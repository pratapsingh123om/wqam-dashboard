# 1) ensure you are in repo root
cd /path/to/wqam-dashboard-main   # change path if needed
pwd

# 2) create backend/.env
cat > backend/.env <<'EOF'
DATABASE_URL=postgresql://wqam:wqam_pass@postgres:5432/wqamdb
REDIS_URL=redis://redis:6379/0
JWT_SECRET=supersecret_jwt_key_change_this
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=wqam-files
SENDER_EMAIL=no-reply@example.com
EOF

# 3) create frontend/.env (Vite)
mkdir -p frontend
cat > frontend/.env <<'EOF'
VITE_API_BASE=http://localhost:8000
VITE_API_WS=ws://localhost:8000
EOF

# 4) verify files
ls -la backend/.env frontend/.env
echo "backend/.env:"
sed -n '1,200p' backend/.env
echo "frontend/.env:"
sed -n '1,200p' frontend/.env

# 5) add, commit
git add backend/.env frontend/.env
git commit -m "Add environment files for backend and frontend"

# 6) start the stack (build if needed)
docker compose up --build -d

# 7) create admin user inside backend container (wait a few secs for DB to init)
sleep 8
docker compose exec backend python create_admin.py

# 8) tail backend logs if you need to debug
docker compose logs -f backend --tail=200
